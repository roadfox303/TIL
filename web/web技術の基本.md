# **Chapter1**
## web技術とは

### ■ World Wide Web
- webの正式名称。
- ハイパーテキストという言語で構成されている。
- ハイパーテキストにはハイパーリンクを埋め込む事ができる。
- 全てがクモの巣状にリンクされることにより、全体で情報の集合体となっている。
- 一つのドメインにある複数のwebページの集まりをWebサイトという。

### ■ インターネットとweb
##### web
- CERN(欧州原子核研究所)のティムバーナーズ＝リーにより開発された。
- 世界中の研究者間で情報を素早く共有するのを目的としていた。
- W3C(**W**orld **W**ide **W**eb **C**onsortium)により統一規格を決め標準化されている。
- W3Cは他にもCSS、XML、XHTMLなども標準化している。

##### インターネット
- ARPA（アメリカ国防省の研究局）により世界各地にある米情報拠点を結ぶために開発されたネットワークARPANETが元になっている。
- 初期は回線費用が高価で、企業や研究機関だけのものだったが、技術発展と普及に伴い安価となり民間に普及した。

当初は文字しか扱えなかったwebが画像を扱えるように拡張され、インターネットと合わせて活用される事で相互に広く普及した。

##### 活用
- ユーザーがコンピュータの機能を用いデータをやり取りするための仲介機能を「UI」(ユーザーインターフェース)という。
- ソフトウェア同士が互いの機能を用いデータをやり取りするための仲介機能を「API」(アプリケーションプログラミングインターフェース)という。

### ■ htmlとwebブラウザ
- ハイパーテキストを記述するための言語「HTML」(Hyper Text Markup Language)
- webブラウザは人間には分かりづらいハイパーテキストを分かりやすく構成して表示してくれるプログラム。

### ■ webサーバとHTTP
- webサーバーはwebブラウザからのリクエスト（要求）に対し、必要なコンテンツを送信する。
- webサーバは静的な
- HTTP(**H**yper **T**ext **T**ransfer **P**rotocol)とは、webブラウザとサーバーがコンテンツ（ハイパーテキスト）やりとりする手順（プロトコル）の規格。
- コンテンツ以外にも、コンテンツが無い場合の応答、サイトの移転など様々な事をブラウザに伝えるしくみを、世界標準で規定している。
- HTTPは暗号化されていないが、SSLで暗号化しセキュリティを高めたHTTPSがある。

### ■ Webページが表示される流れ
1. URLを用いてWebサーバーにアクセス
- URL(**U**niform **R**esouce **L**ocator)には「どんな手順で」「どのwebサーバーに」「なんのコンテンツを」取りに行くかという情報が含まれている。
2. サーバが指定された手順でコンテンツをwebブラウザに転送
3. webブラウザがHTMLをタグを元に解釈、人間に見やすくして描画する。
4. さらに画像など、付随するファイルを転送する。
- 一度の転送では１つのファイルしか送られない。HTMLを解釈し、画像などが必要になった場合は、再度webサーバーにファイルを要求する。
- 送られた画像などを表示画面にはめ込んで再構成。

**http://www.sbcr.jp/index.html**

**http** (というプロトコルでアクセスします) **://www.sbcr.jp** (というサーバに対し) **/index.html** (というファイルを要求)

### ■ 静的ページと動的ページ
- 何度アクセスしても同じものが表示されるwebページを **静的ページ** という。
  - 企業や団体の紹介サイトなど、決まった情報を表示しなければいけないもの。
- アクセスした状況に応じて異なる結果を表示するwebページを **動的ページ** という。
  - 検索結果によって変わる検索サイトや、商品の変わるECサイト、刻々と記事が追加されているブログやSNSなど。

### ■ 動的ページの仕組み
##### CGI (Common Gateway Interface)
- webサーバーがwebブラウザからの要求に応じてプログラムを起動させるための仕組み。
- 動的ページを表示する際はCGIがプログラムを起動する。
- 起動されたプログラムがHTMLを作り出しwebサーバーを経由してwebブラウザに送られる。

##### サーバーサイド・スクリプト
- CGIから呼び出されるプログラムをサーバーサイドスクリプトと呼ぶ。
- Perl、Ruby、Python、PHP、JavaScriptなど。

##### クライアントサイド・スクリプト
- HTMLに埋め込まれ、webブラウザによって実行されるプログラム。
- 主にJavaScriptが使われる。

### ■ Webの設計思想
##### RESTful
- REST(**RE** presentational **S**tate **T**ransfer) とは４つの原則からなるシンプルな設計。
- RESTfulなシステムは「前回のやりとり結果」などを保持しなくてもよいため、シンプルな構造になりやすい。
- RESTfulなシステムは処理を円滑に行えるので多くのwebアプリケーションはRESTfulに設計されている。

###### セマンティックWeb
- Webページの情報に意味（セマンティック）を付加する事でコンピュータが意味を理解して処理できる設計思想。
- HTMLでは意味を付加できないのでXMLで構成される。
- 情報に関する意味を示す情報を **メタデータ** という。
- まだまだWeb全体へは普及していない。

# **Chapter2**
## webネットワーク技術

### ■ Webを実現するネットワーク
- **サーバー** とはネットワークにおいて情報やサービスを提供するコンピュータ。
- **クライアント** とはサーバーから提供された情報を利用するコンピュータ。
- サーバー（提供側）とクライアント（利用側）とコンピュータに役割を分担させて分担処理を目的とした仕組みを **クライアント/サーバーシステム** という。
- スマートフォンやパソコンを利用してwebを閲覧する場合、**インターネットサービスプロバイダー** が提供するサービスを利用してインターネットに接続する必要がある。
- インターネットサービスプロバイダーは単に **プロバイダー** や **ISP** と略される事が多い。
- ユーザーはプロバイダーに、プロバイダーはプロバイダー同士で繋がってネットワークを構成する。
- **１次プロバイダー** は海外プロバイダーと直接繋がったり、**IX (Internet Exchange)** と呼ばれる接続点を利用しネットワークに繋がっている。１次プロバイダーに接続してネットワークしているサーバーは **2次プロバイダー**、さらに3次など階層化されている。

### ■ インターネットの標準プロトコル
- プロトコルとは、ネットワークに接続された機器が通信するときの、あらかじめ決められたルールや手順。

##### HTTP
- **H**yper **T**ext **T**ransfer **P**rotocol の略で HyperText つまりはwebコンテンツの送受信をするためのプロトコル。

##### TCP/IP
- **T**ransmission **C**ontrol **P**rotocol / **I**nternet **P**rotocol とは、インターネットにおける様々なサービスを実現するプロトコルの集まり。
- 昔はOSや機器ごとに違うプロトコルが用いられ互換性がなかった。インターネットの普及でこれらを相互に接続するため、TCP/IPでが標準として広く用いられるようになった。
- **HTTP** もTCP/IPにおける **アプリケーション同士のやりとりを行うプロトコル** として含まれている。
- TCP/IPは役割ごとに４つのレイヤー（階層）に分かれている。
  |レイヤー|レイヤー名|役割用途|プロトコルの例|
  |:---:|:---:|:---:|:---|
  |4|アプリケーション層|アプリケーションごとのやりとりを規定|HTTP、SMTP、FTPなど|
  |3|トランスポート層|データの分割や品質保証を規定|TCP、UDP|
  |2|インターネット層|ネットワーク間の通信を規定|IP、ICMPなど|
  |1|ネットワークインターフェース層|コネクタ形状や周波数などハードウェアに関する規定|イーサネット、Wi-Fiなど|
- アプリケーション層では、ブラウザやメーラーなどアプリケーション毎のやりとりを規定している。これらのアプリケーションの多くはクライアント/サーバーシステムで構成されている。
- アプリケーション層では、扱うデータをネットワーク転送に適したデータ形式に変換、また逆にネットワーク経由で受け取ったデータを元の形に変換（復元）する役割を持っている。
- データの転送処理などはアプリケーション層より下位の宗が担当している。

##### TCPとUDP
- TCPでは分割されたデータの順序や欠落をチェックしている。正確だが処理に一手間かかる。
- UDPはそれらの処理が省略されているため、信頼性は低いが効率のよい通信が可能。動画ストリーミングなどで使用される。


|略称|プロトコル名|用途|
|:---:|:---:|:---|
|HTTP|**H**yper **T**ext **T**ransfer **P**rotocol|webブラウザとwebサーバー間でデータをやり取りするための送受信用プロトコル。|
|FTP|**F**ile **T**ransfer **P**rotocol|コンピュータ間でファイルをやり取りするための送受信用プロトコル。|
|SMTP|**S**imple **M**ail **T**ransfer **P**rotocol|電子メールを送信するための送信用プロトコル。|
|POP|**P**ost **O**ffice **P**rotocol|電子メールを受信するための受信用プロトコル。|

### ■ IPアドレスとポート番号
##### IPアドレス
- コンピュータを特定する識別番号。
- インターネットにおいて同じIPアドレスは存在しない。住所のようなもの。

##### ポート番号
- コンピュータ上で動作する各アプリケーションが提供するサービスを、識別するための番号。
- マンションの部屋番号のようなもの。
- IPアドレスとポート番号を指定する事で、特定のコンピュータの特定のサービスを受け取る事ができる。
- **Webサーバー(HTTP)は一般的に80番** といったようにポート番号でサービスを識別できる。

### ■ URLとドメイン
- URL(**U**niform **R**esource **L**ocator)
- **http** (プロトコル) **://example.com** (サーバ) **/test.html** (ファイル)
- HTTPでの接続は80番と決まっているため、通常はURLからポート番号が省略されているが、省略せず表記すると http://example.com:80/test.html となる。
- IPアドレスが存在するが、人には覚えにくいので **example.com** のようなドメインがIPの別名として用いられる。
- ドメインもIP同様一意であり同じドメインは存在しない。

http://example.com:80/test.html  
スキーム名(たいていはプロトコル名)://ホスト名(ドメイン):ポート番号/ファイルパス名

### ■ DNS
- ドメインとIPアドレスを変換する仕組みを DNS(**D**omain **N**ame **S**ystem)という。
- DNSサービスを提供するサーバーをDNSサーバーという。
- DNSサーバーでは、ドメインとIPアドレスが紐づいて管理されている。
- 世界中の複数のDNSサーバーがツリー状の階層構造をとり分散処理することで、膨大なドメインを効率よく処理している。
- ドメインは「.」（ドット）で区切られた階層構造になっており、それぞれの階層にDNSサーバーがある。

### ■ HTTP
- クライアント（webブラウザ）がサーバー（Webサーバー）に要求を送り、webサーバーはそれに応答する。という単純なやりとりでwebサイトが表示される。
1. webブラウザのアドレス欄にURLを入力、またはwebサイトのリンクをクリック。
2. URLやリンク情報に基づいてWebサーバーに対してデータを要求
3. Webブラウザから要求を受け取ったWebサーバーは、要求内容を解析
4. 解析した結果により、要求されたデータをWebブラウザへと応答。
5. WebブラウザはWebサーバーから受け取ったデータを解析し、Webページとして表示。

- ２、と４のステップがWerbコンテンツの送受信部分。この際にHTTPが利用される。
- HTTPはあくまでデータのやりとり（要求と応答）のみ決めている。Webサイト閲覧の際は、HTTPだけでなくIP、TCPなどさまざまなプロトコルを組み合わせて利用している。

# **Chapter3**
## HTTPでやりとりする仕組み

### ■ HTTPメッセージ
- HTTPプロトコルにおいてwebブラウザとwebサーバーでやりとりする際に利用されるのが **「HTTPメッセージ」** と呼ばれるデータ形式。
- HTTPメッセージは二種類に分けられる。
- WebブラウザからWebサーバーへの要求であるのが **「HTTPリクエスト」**
- WebサーバーからWebブラウザへの応答であるのが **「HTTPレスポンス」**
- HTTPでは基本的に、１つのリクエストに対して１つのレスポンスを返す。
|HTTPメッセージの構成|
|:---:|
|開始行（リクエスト行、ステータス行）(1行のみ)|
|メッセージヘッダー(複数行可)|
|空行(1行のみ)|
|メッセージボディ(複数行可)|
- HTTPリクエストとHTTPレスポンスでは開始行の構文が異なり、リクエスト事は「リクエスト行」、レスポンス事は「ステータス行」と呼ばれる。

### ■ HTTPリクエスト/HTTPレスポンス
##### HTTPリクエスト
- 「リクエスト行」「メッセージヘッダー」「メッセージボディ」の３つで構成される。
- リクエスト行
  - Webサーバーにどんな処理をして欲しいか
- メッセージヘッダー
  - Webブラウザやそのバージョン、Webサーバーの種類、送信するデータ形式などの付加情報
- メッセージボディ
  - フォーム欄に入力したテキスト内容など。

##### HTTPレスポンス
- 「ステータス行」「メッセージヘッダー」「メッセージボディ」の３つで構成される。
- ステータス行
  - Webブラウザから受け取ったリクエストに対しての、Webサーバーでの処理の結果。
- メッセージヘッダー
  - Webサーバーの種類、送信するデータ形式などの付加情報
- メッセージボディ
  - Webブラウザから要求されたHTMLなどのデータ

Webブラウザはレスポンスで受け取ったHTML内に、リンク画像などが存在する場合、その画像をWebサーバーに要求するため（ファイル毎に）新たにリクエストを送る。その繰り返しで画面が表示される。

### ■ HTTPメソッド
- webサーバーに要求内容を伝えているのは、HTTPリクエスト（リクエスト行）に含まれるHTTPメソッド。
- web閲覧で主に使用されるのは **GET** と **POST**。

|メソッド|用途|説明|
|:---:|:---:|:---|
|HEAD|HTTPヘッダ情報を取得する|データ更新日やデータサイズのみを所得したい場合などに使用する。|
|GET|データを受けとる|データ送信することもできるが、URLの末尾に付加して送る必要があり、閲覧履歴に残るなどセキュリティ的に弱い。URLは最大文字数2083文字のため大きなデータは送れない。|
|POST|データを送る|データはHTTPリクエストのメッセージボディに含まれる。閲覧履歴には残らない。秘匿データに向く。|
|PUT|データアップロード|webサーバ上のファイルが上書きされるため、利用できないように制限されている場合が多い|
|DELETE|データ削除|指定したデータを削除する。PUT同様に制限されている場合が多い。|
|CONNECT|サーバを中継接続する|悪用した攻撃があるため利用を制限されている場合が多い。|
|OPTIONS|利用可能なHTTPメソッドを確認|PUTやDELETEなど利用を制限されているメソッドがあるため、事前に確認する時などに使う。|
|TRACE|接続経路を捕捉|WebブラウザとWebサーバの経路をチェックする場合に使用する。悪用した攻撃があるため利用を制限されている場合が多い。|

### ■ ステータスコード
- HTTPレスポンス内にはHTTPリクエストに対するWebサーバーでの処理結果が含まれる。それが **ステータスコード**。
- ステータスコードは５つに分類される。

|ステータスコード|説明|
|:---:|:---|
|**100** 番台|HTTPリクエストを処理中。Webサーバーがデータを受け入れ可能かどうか確認するための一時応答で使用される。|
|**200** 番台|HTTPリクエストが正常に処理を完了。|
|**300** 番台|HTTPリクエストに対し追加処理の要求。転送処理などブラウザ側で追加の処理が必要な事を通知している。WebサイトのURLが変更されている場合などに使用される。
|**400** 番台|クライアント（Webブラウザ）のエラー。HTMLがサーバーに存在しない404などに使用される。|
|**500** 番台|サーバーエラー。Webサーバーが何らかのエラーや、高負荷で一時的にWebコンテンツを転送できない場合などに使用される。|

### ■ メッセージヘッダー
- HTTPリクエストとHTTPレスポンスは、メッセージヘッダーを利用する事でHTTPメッセージに関する詳細情報を送信する事ができる。
- メッセージヘッダーは複数行のメッセージフィールド行から成り立つ。
- フィールド名: フィールド値　※コロン（：）と1文字スペースで区切られる。
- 例）Date: Sun,01 Jan 2017 00:00:00 GMT

||説明|
|:---:|:---|
|一般ヘッダーフィールド|HTTPリクエストとHTTPレスポンス双方に含まれる。HTTPメッセージ全体に対しての付加情報を示す。データ作成日である**Date**など。|
|リクエストヘッダーフィールド|HTTPリクエストのみに含まれる。ブラウザ情報などクライアント固有情報を示す**User-Agent**など。|
|レスポンスヘッダーフィールド|HTTPレスポンスのみに含まれる。Webサーバー機能を提供するプロダクト情報を示す**Server**など|
|エンティティヘッダーフィールド|HTTPリクエストとHTTPレスポンス双方に含まれる。メッセージボディに含まれるデータの付加情報を示す。**Content-Type**など。|

### ■ TCPによるデータ通信
- HTTPリクエストやHTTPレスポンスなどHTTPデータのやりとりはTCPの役割。
- TCPはまずクライアントとサーバーが互いに通信可能な状態なのか確認し **「コネクション」** と呼ばれる通信経路を確立したうえでデータのやり取りを行う。
- コネクションの確率は以下の３回のやりとりで行われる。

 |1. SYN (クライアントからの接続要求)|
 |:---|
 |クライアントからサーバーに対して接続を要求する **SYNパケット** と呼ばれるデータを送る。|

 |2. SYN+ACK (クライアントに対して確認応答、サーバーからの接続要求)|
 |:---|
 |TCPではデータ送信後、必ず相手からの確認応答を受け取ることでデータ送信が完了したと判断する。そのためブラウザへの確認応答に **ACKパケット** を送信する。またサーバからクライアントへの接続要求のためSYNパケットを同時に送信する。|

 |3. ACK (サーバに対しての確認応答)|
 |:---|
 |ブラウザはサーバからの接続要求に対して、ACKパケットを送信し、互いに接続が可能な事を確認できてはじめてコネクションの確率が完了する。|

### ■ HTTP/1.1のやりとり
##### HTTPキープアライブ
- HTTP/1.0以前では、HTTPリクエスト毎にコネクションの確立から閉鎖までを行うため、webページに画像などが埋め込まれているような場合、再度コネクションの確立から行う必要があり、無駄な通信が嵩むこととなった。
- 1.1以降はコネクションを継続して利用する方式となった。この機能を **HTTPキープアライブ** という。

##### HTTPパイプライン
- HTTP/1.1ではデータやりとりの効率化のため **HTTPパイプライン** という機能がサポートされている。
- HTTPではひとつHTTPリクエストを送ると、そのレスポンスを受け取るまでは、次のHTTPリクエストを送信できないが、HTTPパイプラインでは先のレスポンスを待つ事なく次のリクエストを送る事ができる。

### ■ HTTP/2のやりとり
- 1999年以降、Webサイトが複雑化し多くの画像が使われるようになると、1.1よりさらに高速化する事を目的に **HTTP/2** が登場した。
- HTTP/2はGoogleが提案した **SPDY** というプロトコルがベースとなっている。
- 2015年5月に正式に標準化された。

##### ストリーム
- HTTP/1.1のHTTPパイプラインは連続してリクエストを投げる事ができるものの、サーバーはリクエストの順番通りにレスポンスを返さなければならなかった。
- 連続したレスポンスの中で、処理時間の掛かるレスポンスがあった場合、後続のレスポンスはそれを待たねばならず後がつっかえる形になる。
- HTTP/2ではそれに対処すべく **ストリーム** と呼ばれる仮想的な通信経路を複数生成し並列でデータをやり取りできる。各ストリームは独立してリクエストとレスポンスをやりとりすることで、レスポンス待ち状態が発生する事がなくなった。

##### バイナリ形式の利用
- HTTP/1.1以前では、HTTPリクエストやHTTPレスポンスは、テキスト形式のフォーマットで行っていた。
- HTTP/1.1以前では、バイナリデータをやり取りする際、一旦テキストへ変換する必要があった。
- HTTP/2ではバイナリデータをそのままやり取りできるので、ブラウザやサーバーの負担を軽減できる。

##### ヘッダー圧縮
- HTTP/1.1でもテキスト形式のファイルデータを圧縮して転送することはできた。
- HTTP/2ではヘッダー情報も圧縮する事が可能となった。
- ヘッダー情報はブラウザバージョン情報など、毎回重複するものが多くある。HTTP/2では **HPACK** と呼ばれる圧縮方式を用いる事でヘッダー情報の中から差分だけを送り、転送量を削減する事ができる。

##### サーバープッシュ
- HTTP/2では、サーバがブラウザからのリクエスト内容をもとに、サーバが必要なファイルを判断し事前にWebブラウザに送信する事が可能。埋め込み画像などをブラウザからのリクエストを待つ事なく判断して送信できる。

### ■ HTTPSの仕組み
- HTTPは暗号化されておらず、クレジットカードなどの個人情報等を盗聴されたり、なりすましサイトにより盗まれる恐れがある。
- https(HTTPS over SSL/TLS)の略で、HTTPの通信において暗号方式であるSSL(**S**ecure **S**ockets **L**ayer)や TSL(**T**ransport **L**ayer **S**ecurity)を利用する事でセキュリティを高めている。
- HTTPSで利用されるSSL/TLSでは以下の３つのしくみで安全性を確保している。

##### 盗聴防止(暗号化通信)
- いくつものサーバを経由する通信内容を傍受することは比較的容易であるため、傍受されても解読されないように暗号化して送信する。

##### 改ざん防止
- ネットバンキングなどで振込先を書き換えられるなどの改ざん対策として **「メッセージダイジェスト」が利用される**
- データから一意のデータ（ハッシュ値）を取り出し、データ送信時のハッシュ値と比較して改ざんを検知できる。

##### なりすまし防止(Webサイト運用元の確認)
- Webサーバーに **「SSLサーバ証明書」** と呼ばれる電子証明書を配置しておき、接続事に検証することでWebサイトの運営サイトの身元を確認できる。
- 信頼できない発行元のSSLサーバ証明書が利用されている場合、ブラウザ上に警告が出る。

### ■ HTTPSのやりとり
##### SSL/TLSハンドシェイク
- HTTPSはSSLあるいはTLSにより、以下の4つのフェーズでやりとりされる。
- この4つのフェーズはSSLあるいはTLSにより実現するため **SSL/TLSハンドシェイク** と呼ばれる。

|1. 暗号変化方式の決定|
|:---|
|Webサーバー、Webブラウザ双方で利用可能な暗号化方式を決める必要がある。HTTPSで利用するSSLあるいはTLSのバージョンや、メッセージダイジェストの方式も決定する。|

|2. 通信相手の証明|
|:---|
|ブラウザが通信しているWebサーバーが正しい相手なのかを、SSLサーバー証明書により確認する。正しい事が確認できない場合はブラウザに警告が出る。|

|3. 鍵の交換|
|:---|
|データ転送に利用する鍵を交換する。鍵はデータを転送する際の暗号化、復号する際に利用される。|

|4. 暗号化の確認|
|:---|
|実際に利用する暗号化方式の最終確認をする。このフェーズが完了するとブラウザとサーバー間で暗号化通信が開始される。|

### ■ ステートフルとステートレス
- HTTPはシンプルな **ステートレス** であることが特徴。ステートレスとは「状態を保持しない」という意味。
- 状態を保持して次の処理内容に反映させる方式を **ステートフル** という。
- ステートフルはサーバーが多数のクライアントの処理を行う場合に、保持した情報をもとに処理しなくてはならないため負担となる。HTTPでは素早い処理のためにステートレスな設計が適している。

### ■ Coockie
- HTTPはステートレスなプロトコルなので、ショッピングサイトのカートなど、状態を保持する仕組みがない。そこで **Coockie** が用いられる。
- サーバに接続してきたブラウザに対して、コンテンツと一緒にWebブラウザに保存して欲しいデータをCoockieとして送る。

##### Set-Coockie
- Coockieの送信にはメッセージヘッダーが利用される。
- HTTPレスポンスに **「Set-Coockie」ヘッダー** を含める事でCoockieを送信できる。
- Set-Coockieヘッダーにはオプションで、有効期限を設定したり、HTTPSのみをCoockieを送信する設定などかできる。

##### セッションCoockie
- 有効期限が設定されていないCoockieはWebブラウザが閉じられると削除される。
- 有効期限が設定されていないCoockieは **セッションCoockie** という。
- 有効期限が設定されたCoockieはブラウザを閉じても削除されず有効期限までブラウザ上にる。
- 他人に盗まれるとなりすましされる事があるため、ショッピングサイトなどではセッションCoockieがよく利用される。

### ■ セッション
- WebブラウザとWebザーバーのやりとりにおいて、一連の関連性のある処理の流れを **セッション** という。
##### セッションの管理
- 多数接続がある中から特定のブラウザからの処理を一連の処理（セッション）として扱いたい場合はCoockieを用いてセッションを管理できる。
- セッション管理において、ブラウザを認識するための情報を **セッションID** と呼ぶ。
- ブラウザはサーバーから受け取ったセッションIDをCoockieに含めて処理を行う事でセッションを維持できる。
- セッションでやりとりされたデータはサーバーに **セッションデータ** として残される。
##### セッションIDのやりとり
- セッションIDのやりとりはCoockieを用いるのが一般的だが、Coockieをつかえない場合はURLにセッションIDを埋め込む手法もあるが情報漏洩の可能性が高いためあまり利用されない。

### ■ URI
- 情報やデータといったリソースを識別するための記述方法を **URI** (**U**niform **R**esource **I**dentifier)という。
- URIはコンピューターが扱うリソースの限らず、人、会社、組織などあらゆるリソースを示す事ができる。
- URIのうちリソースの場所を示すものを**URL** (**U**niform **R**esource **L**ocator)という。
- URIのうち場所は問わずリソースの名前を示すものを**URN** (**U**niform **R**esource **N**ame)という。

##### リクエストURI
- HTTPにおいて、リクエストの場合URIはリクエスト行のメソッドに続いて記述され、 **リクエストURI** と呼ばれる。
- URI全てを含める **絶対URI** と、URIの一部を含める **相対URI** がある。通常は相対URIで記述される。

##### パーセントエンコーディング
- URIで使用できる文字は決められており、「予約文字」と「非予約文字」がある。
- 予約文字は用途が定められており、それ以外では使用できない。
- 非予約文字とは数字やアルファベットなど自由にURIに使用できる文字。
- どちらでもない文字をURIで使用する場合は **「パーセントエンコーディング」** と呼ばれる表記法に文字を変換しなければならない。文字コードを16進数で表し「%e7%a3%f9%」のように変換する。

URIはスキームと呼ばれる拡張子で始まり、続いてコロンで区切って各スキームで決められた表現形式で記述される。

|スキーム|スキームごとの表現方法|
|:---:|:---|
|http:|//example.com/news/index.html|
|htp:|//example.com/docs/news01.doc|
|urn:|isbn:0-123-45678-9|

# **Chapter5**
## Webアプリケーションの基本

### Webアプリケーションの３層構造（3層アーキテクチャ）
- ネットワークを介してWebブラウザ上で動作するアプリケーションをWebアプリケーションという。
- webアプリケーションは基本的に3層構造になっている。
- ユーザーインターフェースとなる **プレゼンテーション層**、業務処理を行う **アプリケーション層**、データ処理や保管を行う **データ層**。
- ３層に分け、それぞれに専用のサーバーに処理を振り分けることにより負荷の分散ができる。
- 改修作業においても、各層に分かれているため、他の層に影響を及ぼさずに改修作業が行える。

### MVCモデル
- 3層アーキテクチャの他にMVCモデルがある。

### webサーバー
- webサーバーが１台構成の場合、故障するとサービスが停止してしまうため、複数のwebサーバーを用いて１台が故障してもサービスが停止しないようにする「冗長化」という構成をとることが一般的。

### アプリケーションサーバー
- APサーバー
- セッション管理を行う
- トランザクション管理機能
- 予約手続きのような「すべてのやりとりが成功するまで完了しない」処理は。１つのリクエスト・レスポンス単位ではなく、トランザクション単位で管理する。
  - トランザクション
    1. ログイン
  - トランザクション
    2. 空室情報の確認
    3. 空室を１部屋減らす
    4. 空室に予約者を追加 (他は正常で4のみ失敗したとしても宿泊予約としては成り立たない)
    5. 予約の確定
  - トランザクション
    6. ログアウト (6のみの失敗であればログアウトは失敗だが、宿泊予約処理は成功している。)

### データベース管理システム
- データベース管理システム (**DBMS** : **D**atabase **M**anagement **S**ystem)
- **DBMS** を搭載したサーバー機器をデータベースサーバーという。
- データベースは保存データが非樹に重要なため、基本的に冗長化構成をとる。

##### 冗長化方法
- **ミラーリング**
  - データ更新命令を受けたDBMSが複数のデータベースに対して同時に同じ更新を行う。
- **レプリケーション**
  - データ更新命令を受けたDBMSが更新の内容を別にDBMSに連携し、連携を受けたDBMSが自身の管理するデータベースに同じ更新を実行する。
- **シェアードディスク**
  - データベースを共有のストレージに持った複数のDBMSから更新する。データベース（ストレージ内容）自体は冗長化しないのでストレージには強い耐障害性が必要。

### キャッシュサーバー
- 更新の少ないコンテンツや、データに対するレスポンスを覚えておけば、毎回コンテンツを読み込んだりデータ検索する必要がなくなる。
- このリクエストにたいすレスポンスを覚えておく役割をするのが **キャッシュサーバー**
- 動画やファイルといったコンテンツのキャッシュは **コンテンツキャッシュ**
- DBMSのデータ検索要求(クエリ)の結果のキャッシュは **クエリキャッシュ**
- キャッシュのせいでいつまでも更新されないとレスポンスが反映されないため、キャッシュには有効期限を設定しておく必要がある。

##### CDN (Contents Delivery Network)
- CDNは世界各地に分散配置されたキャッシュサーバーの集合体。
- 予め画像や動画など大容量コンテンツのキャッシュをWebサーバーから取得しておきCDN前足しで１台のキャッシュサーバーのように動作する。
- アクセス元からネットワーク的に一番近いサーバーが対応する事で、よ理早いレスポンスが返るようになっている。
- CDNは定期的にWebサーバーからコンテンツのキャッシュを取得する。

### Ajax
##### 同期通信
- ブラウザとサーバーが交互に処理（リクエストとレスポンス）を行い同調して通信を行うことを **同期通信** という.
- レスポンスを待つのでページの更新に時間がかかる。
- 送信するデータも多くなりがちでサーバーに負担がかかる。
##### 非同期通信
- **Ajax** (**A**synchronous **Ja**vaScript + **X**ML)
- javaScriptが直接Webサーバーと通信を行ってデートを取得、画面のHTMLを更新する。
- データのやり取りにはXMLが用いられ、JavaScriptはDOMを使ってXMLやHTMLを操作する。
- Webブラウザの代わりに通信を行うので非同期通信が可能となる。

### WebAPI
- Webを通じてユーザーではなくプログラムが直接サービスを利用するための窓口。
- **Web API** (**A**pplication **P**rogram **I**nterface)
- やりとりの方法は **XML-RPC**、**SOAP**、**REST** 。データ形式がXMLに限らず **JSON** も使用できるためRESTが主流となってきている。

### マッシュアップ
- 複数のAPIの処理結果を活用し新たなWebサービスを生み出すことを **マッシュアップ** という。
- マッシュアップなサービスでは、各社のサービスからいいとこどりできるものの、元になるサービスが仕様を変更したり公開を終了すると続けられなくなるリスクがある。

### CGI
- Webサーバーがクライアントからのリクエストに応じてサーバーサイドスクリプトを起動するためのしくみ。
- Webサーバー上で実行したときの結果をレスポンスとして返す。
- APサーバーを用意しなくてもWebサーバー上でサーバーサイドスクリプトを実行できるため、小規模な動的ページの作成で多く用いられる。

##### データの渡し方
- クライアントがCGIのURLにアクセスすることで対象となるプログラムが起動される。
|方法|詳細|
|:---:|:---|
|コマンドライン引き渡し|http://example.com/program.cgi?データ1+データ2<br>webサーバーがCGIプログラムを実行するときにデータをCGIに渡す|
|パス渡し|http://example.com/program.cgi/データ1/データ2<br> **PATH_INFO** という変数に格納される。CGIが起動後にそこから変数を取り出す|
|HTTP GETメソッド|http://example.com/program.cgi?data1=データ1&data2=データ2<br> **QUERY_STRING** という変数に格納される。|
|HTTP POSTメソッド|リクエストとしてURLとは別にデータを送る。データがわからないのでPOSTメソッドを利用すると安全。|

### サーバー間の連携
- CGIを利用せずにサーバーサイドスクリプトを動作させる場合は、WebサーバーがAPサーバーにデータ処理を要求する。
- その場合Webサーバーがクライアント、APサーバーがサーバーという関係となる。APサーバーとDBMSも同様。
- サーバー同士の通信もTCP/IP通信が行われる。
- APサーバーもDBMSも予めポート番号が割り当てられている、クライアントはそのポート番号を指定することになる。
- それぞれ別のサーバー機器で動作している場合は、それぞれのIPアドレス。同じ機器上で動作している場合は、その機器のIPまたは「自身」を表す特殊なIPアドレス「127.0.0.1」を指定して通信する。
- APサーバーやDBMSでも利用するプロトコルは決まっているが、HTTPのように「これ！」という決まりはない。
- HTTP意外にも **AJP** や **WebSocket** といったプロトコルが利用されており、Web　サーバーはいずれかを用いてAPサーバーとやりとりを行う。
- APサーバーとDBMSが通信するために、**ODBC**(**O**pen **D**atabase **C**pnnectivity)というAPIが開発されている。
